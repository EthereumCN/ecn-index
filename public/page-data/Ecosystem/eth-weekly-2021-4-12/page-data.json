{"componentChunkName":"component---src-template-article-js","path":"/Ecosystem/eth-weekly-2021-4-12/","result":{"data":{"strapiArticles":{"title":"以太七日谈 • 2021/4/12","summary":"柏林硬分叉，gas费低的原因？","publishDate":"2021-04-12","author":"ECN","authorImg":{"childImageSharp":{"fixed":{"src":"/static/18e33ca02b0130c3f952c7a725931e7a/497c6/ac7e303d9bcf9058c207ba55f49192bb.png"}}},"content":"![cover](https://i.ibb.co/YpNxxk0/cover.png)\n\n<br/>\n\n**最近的低 gas 费与攻击抢跑机器人有关？**\n\n![why](https://i.ibb.co/JQDdBnb/why-gas-low.png)\n\n\n\n这两天的低 gas 费是因为币安智能链吸引了新用户？Flashbot 和 PGA 机器人的作用？以太坊上的利益广泛减少？还是三者都有？\n\n尽管不确定答案，但这期七日谈想深入两个攻击抢跑机器人的案例。\n\n4.9 出现这样一笔特别高交易费的交易，交易发送者给鱼池矿工转了68.13个 ETH 的交易费，而支付的 gas 费则是零。\n\n![event](https://i.ibb.co/ryDBsZ6/4-10-bot.png)\n\nRober Miller @bertcmiller 在推特上对这件事进行了解释。以下为他的推特的编译：\n\n这笔交易非常有趣！一个机器人一直在尾追 (backrunning) 一些新上交易所的代币，有效地在其他人之前通过支付额外费用给矿工买到这些代币。而 4.9 有个新上交易所的代币进行了回击，给该机器人设陷阱获得 20 万美元，同时因机器人购买他们的代币而获利。事情是这样的：\n\n在过去几周，这个机器人一直在监测以太坊交易池里在 Uniswap 上新创建的交易对。如果它发现了，它会在交易对上线后马上买入，这样它就可以比任何人都早买入这个新代币。\n\n![liquilidity](https://i.ibb.co/rFHCNvy/initial-liquidity.jpg)\n\n这种机器人一直给矿工支付高额费用。你可以在这里看到，Flashbot 中矿工费最高的一些汇总交易都是来自这个机器人（标黄）。这些机器人一共支付了 340 个 ETH 给矿工。\n\n注：这是 Flashbot 的仪表盘，是公开的数据。\n\n![flashbot](https://i.ibb.co/CKhZtcb/flashbot.png)\n\n这个机器人通过做这样的事可以赚非常多的钱。他们一开始以10 万~20 万美元买入，把价格快速推高，然后逐渐以高出它们买入时几倍的价格慢慢抛售。\n\n一个社区成员监测了这个过程并发现它们在这样一次操作中可以赚得 200 万美元。\n\n![profit](https://i.ibb.co/BfLH031/great-profit.jpg)\n\n但这个森林并没有那么黑暗。这些都是引人注目的交易，且 DeFi 社区的人是非常聪明的。\n\n有人给这个机器人设了陷阱：他们部署了一个新的代币，如果交易池启动后 3 个区块内有大量买入的话，这些代币会被冻结。\n\n有趣的是，这个合约名就叫 “LiquidityTrap.sol\"，且在大家都可以在 Etherscan 上看到：\n\nhttps://t.co/vkNa7xzCWH?amp=1\n\n![Liquiditytrap](https://i.ibb.co/0qrGYF0/Liquiditytrap.png)\n\n就在 Uniswap 的交易池开发后，那个机器人掉进陷阱了！ 上线交易所后，它们买入了价值 100 ETH 的 ”Kattana\" 代币，因此掉入了流动性陷阱。它们还支付了 68 个 ETH 给矿工！\n\n![Image](https://i.ibb.co/YPXLRZT/kattana.jpg)\n\n看上去这次是成功了！尽管在后面几个区块里机器人开始抛售其他代币，但 Kattana 的数量没有变。\n\n![trap1](https://i.ibb.co/7Gb6r6K/trap1.jpg)\n\n\n\n![trap2](https://i.ibb.co/PWr7svT/trap2.jpg)\n\n\n\n买入的 6.7 万个代币且现在的价格是 24 美元，总价值是它买入时的 6 倍。\n\n![6](https://i.ibb.co/W2W4S78/6x.jpg)\n\n在我看来，这个机器人现在可以做的只有把所有的 Kattana 发回给合约的所有者或永远持有被冻结的 Kattana。\n\n对 Kattana 来说，它获得了所有的好处——代币价格马上飙升，且无法在二级市场抛售。\n\n![benefit-Kattana](https://i.ibb.co/0MmW0XN/benefit-Kattana.png)\n\n\n\n不确定这是否只是一个陷阱，但 Kattana 是一个认真的项目。\n\n对机器人是否有阻吓作用不得而知，但可能它们赚到的远多于这次损失给 Katanna 的。\n\n看以机器人之道还治机器人之身 (例如，Salmonella) 还是相当精彩的。\n\n（编者注：同样的事情在 4.11 再次发生，@bertcmiller 也对这次事件进行了记录。）\n\n昨晚 (4.11) ，有人用极其聪明的机制从三明治攻击机器人手上夺下 100 个 ETH。随后，有第二个人加入，通过攻击其他三明治机器人获得了 300 个 ETH。详情如下：\n\n要理解事情是如何发生的，你需要对 Flashbot 稍有了解。你可以把 Flashbot 想成是用户通过“汇总”在一起的交易与矿工直接沟通他们想要的交易排序。\n\n不同于用户用 gas 价格来支付交易费， Flashbot 用户通过智能合约调用 (block.coinbase.transfer) 来支付费用，它会把 ETH 转给矿工。\n\n下图是一个套利机器人这样做的屏幕截图，留意看 0 gas 费和 0.075 个 ETH 转给星火矿池。\n\n![case2](https://i.ibb.co/3cC5yYw/case2.jpg)\n\n\n\n矿工会从用户收到很多这样的汇总交易，并把支付得最多的汇总交易打包到区块。用户喜欢这样做因为他们只需要支付被打包了的交易，且可以决定他们想要支付的价格。\n\n三明治机器人监测交易池里用户在 Dex 上的买入情况然后夹击：在受害者买入前把价格推高，在受害者买入后抛售赚钱。这三笔交易 (买入，受害者交易，卖出) 形成一组汇总交易。\n\n注意：三明治的卖出交易是包含付给矿工的智能合约款项的。\n\n![sellpayment](https://i.ibb.co/P6Gct9Q/sell-payment.jpg)\n\n![sellpayment2](https://i.ibb.co/JRxMwzs/sell-payment2.jpg)\n\n打包费用是在卖出交易里支付给矿工的，这一点很重要！也就是说，只有当机器人把抢跑交易里买来的代币成功卖出后才会支付给矿工。如果卖出失败了，矿工是没有打包费的，也就是他们的汇总交易没有被打包成功。\n\n为了进行得更稳妥，机器人会先在本地基础设施上模拟测试它们的交易。只有当模拟进行得顺利时，它们才会发出交易。\n\n（Flashbot 还会提供工具使这个操作更简单。）\n\n[@NathanWorsley_](https://twitter.com/NathanWorsley_) 在发表了他关于 Salmonella 的文章后鼓励一大批人尝试用 ERC20 的代币给三明治机器人下圈套。\n\n简言之，Salmonella 是一种代币，如果你不是合约所有者的话尽量不要交易，而三明治机器人会超额支付并用100 个 ETH 换来 REKT。\n\n三明治机器人仅在卖出交易成功时才会支付交易费，这个设计可以防御这一点。如果你支付的 ETH 无法让你获利，那么你就不会支付！\n\n且三明治机器人会有模拟测试，在这样的情况发生前看看它们获得的是不是 REKT。\n\n但有两个很聪明的人发现这些防御的漏洞。\n\n第一道防御的突破点在模拟测试。这通过 ERC20 合约的转账功能实现，它可以核查该区块是否由一个 Flashbot 矿工挖的，如果是，它会转出很少。下图是我的伪代码。\n\n本地的模拟测试不会有问题，但在实操中三明治机器人获得的是rekt。\n\n![rekt](https://i.ibb.co/QMppC4Q/rekt.png)\n\n\n\n 第二道防御是仅在卖出交易里才有打包费用。\n\n再说一次：三明治机器人给矿工支付费用是以它们获利为条件的。\n\n把这个 ERC 20 代币支付给矿工 （再次提醒：也是我的伪代码）可以打破这道防御。\n\n因此，即使三明治机器人卖出交易失败了，矿工仍然得到打包费用。\n\n![de](https://i.ibb.co/HzC5FC9/defend2.png)\n\n![de2](https://i.ibb.co/prKBnDM/defend2-2.jpg)\n\n\n\n在现实发生的情况是这样的：\n\n三明治机器人成功落入圈套，买入价值 100 个 ETH 的“毒”代币。“毒”代币所有者的诱饵触发自定义的转账功能，这需要给矿工支付 0.1 个 ETH。\n\n三明治机器人的卖出交易因为“毒”代币的设置而不成功。\n\n![p1](https://i.ibb.co/nbN2PL5/poison1.jpg)\n\n![p2](https://i.ibb.co/fYB9bR5/poison2.jpg)\n\n![p3](https://i.ibb.co/xqBJnGT/poison3.jpg)\n\n因为三明治机器人是以汇总的方式将三比交易打包：成功买入、诱饵、失败卖出。\n\n“毒” ERC 20 的支付是自定义转账形式，就是这一点激励矿工去打包。\n\n我想第一个人这样做获得了 100 ETH。你可以在这里看到在 Uniswap 上的交易：https://t.co/UokTURqBkF?amp=1\n\n它们的其中一个受害者是最成功的 Flashbot 机器人操作者组织之一，他们马上作出反应。\n\nhttps://etherscan.io/token/0xe253a1f7d5818022661bfbd2cbe043b642b4eff9?a=0x01f8d5a4862d51d2cf0cf52ac900a4d60adaeee6\n\n在短期内，这个受害者变成顶级掠食者。他们发起一次相似但稍有不同的 ERC20 (\"YoloChain\")，并最终成功诱惑了更多的三明治机器人。\n\n在这次行动中他们获得了 300 个 ETH ！\n\nhttps://t.co/dWNCZe67lZ?amp=1\n\n第一个“毒”代币的所有者发现他们的受害者竟然是区块上最后一个掠夺者，它们在 Flashbot discord 上的加密签名上附上表示尊敬的留言。\n\n我很欣赏。\n\n[https://etherscan.io/verifySig/2503](https://t.co/WpfSnjDLeG?amp=1)\n\n![respect](https://i.ibb.co/YWS5Hpk/respect.png)\n\n根据我的计算，在这次事件中，这两个给机器人下圈套的人总共获得约 400 个 ETH 的，可能还有更多的\"毒“代币是我没发现的。\n\n”大屠杀“事件到这里就结束了。\n\n三明治机器人操作者已经发生相应升级了他们的机器人了。有些已经彻底耗尽了。\n\n<br/>\n\n# Eth2\n\nMikhail Kalinin 发布了 \"Rayonism 的合并规范 v.0.1.0\"，这份文档详述信标链和合并前阶段客户端需要做的修改，以及如何把它们变成合并后阶段的共识节点和执行引擎。\n\n详情：https://notes.ethereum.org/@n0ble/rayonism-the-merge-spec\n\n<br/>\n\nProtolambda 发布了”Rayonism-Meta-Spec\"，以实现合并与分片的测试网。这份meta-spec 内容主要包括：\n\n- 重点放在合并功能的实现\n- 就新功能和黑客松特定修改的快速迭代\n- 内容基本确定下来后把它合并上升为规范\n- 为实现者提供注释和协作重点\n\n文章还包含黑客松的详细行程内容安排。\n\n详情：https://notes.ethereum.org/@protolambda/rayonism\n\n<br/>\n\nProtolambda 还发布了\"多客户端合并后阶段以太坊开发者测试网设置\"。\n\n详情：https://notes.ethereum.org/@protolambda/merge-devnet-setup-guide\n\n<br/>\n\n质押在 Lido 上的 ETH 已达 20 万个 ETH。\n\n来源：https://twitter.com/LidoFinance/status/1381221388414038016?s=20\n\n<br/>\n\n# Eth1\n\n**伦敦升级测试网 Aleut 上线**\n\n4.9 第一个伦敦升级测试网 Aleut 上线，同步数据的指南可能这周推出。\n\n来源：https://twitter.com/TimBeiko/status/1380530805169123339?s=20\n\n<br/>\n\n**节点运行者请在柏林硬分叉前升级所运行客户端的最新版本**\n\n柏林升级即将在 4 月 14 日，区块高度 12,244,000 启动，为了与柏林升级兼容，请节点运行者尽快升级所使用的客户端至最新版本。\n\nBesu [v21.1.4](https://github.com/hyperledger/besu/releases/tag/21.1.4)\n\nEthereumJS VM [v5.3.1](https://github.com/ethereumjs/ethereumjs-monorepo/releases/tag/%40ethereumjs%2Fvm%405.3.1)\n\nGeth [v1.10.2](https://github.com/ethereum/go-ethereum/releases/tag/v1.10.2)\n\nNethermind [v1.10.56](https://github.com/NethermindEth/nethermind/releases/tag/1.10.56)\n\nOpenEthereum [v3.2](https://github.com/openethereum/openethereum/releases/tag/v3.2.0)\n\nTurbogeth [04.02 alpha](https://github.com/ledgerwatch/turbo-geth/releases/tag/v2021.04.02)\n\n<br/>\n\n# Layer2\n\n**追踪 Layer2 解决方案锁仓情况的 L2Beat**\n\n由 [@krzkaczor](https://twitter.com/krzKaczor) 、[@DamianPaszkowsk](https://twitter.com/DamianPaszkowsk) 、 [@piotr.klis](https://twitter.com/piotrklis_) 、[@bkiepuszewski](https://twitter.com/bkiepuszewski) 共同创建的网站 L2Beat：https://www.l2beat.com/ 追踪了部分以太坊解决方案及其项目的锁仓量，以及它们的市场占比，包括 Loopring、Optimism、dydx、zkSync、Aztec、Fuel。而该网站是通过追踪 Layer1 上不同代币桥的代币/ETH 资产来统计各个方案及项目的总锁仓量。\n\n![l2beat](https://i.ibb.co/26qjS06/1.png)\n\n<br/>\n\n**Celer 的 layer2. finance 推出 Ropsten 测试网，参与测试赢得奖励**\n\n状态通道解决方案 Celer Network 推出 layer2. finance 测试网嘉年华活动，通过竞赛活动来吸引用户测试 layer2. finance 系统，并将提供价值 3.2 万美元的奖金。\n\n嘉年华活动时间：UTC 时间 4 月 7 日 - 4 月 19 日\n\n测试网地址：ropsten.layer2.finance\n\n中文版测试指南：[Layer2. Finance 测试网嘉年华](https://mp.weixin.qq.com/s/fGX1vZ9ylp3QAzBK0GIjVw)\n\n\n\n**StarkEx 为 Immutable X 与 dydx 提供扩容解决方案** \n\n基于 StarkEx 解决方案的 Immutable X 于 4 月 9 日上线主网，为 NFT 铸造以及交易提供扩容解决方案。Immutable X 是第一个构建在 L2 上的 NFT 铸造以及交易平台，并且是 StarkEx 的第三个应用案例。\n\n\n\n![2](https://i.ibb.co/1n1RTqm/2.png)\n\n来源：https://www.immutable.com/blog/immutable-x-alpha-trading-launch\n\n另外，StarkEx 的另一个应用案例 dydx 也于 4 月 6 日在主网上线了其永续合约的 Layer2 版本。早在今年 2 月份时， dydx 已经在主网发布了一个接近 Alpha 版本的 Layer2 永续合约供用户、流动性提供者以及战略伙伴使用。过去几周，dydx 中有 110,000 名用户注册进入等候名单，交易数量超 25,000 笔，交易数额约 9 千万美元。而现在，该协议正式面向公众开放。\n\n![3](https://i.ibb.co/LgvhS16/3.png)\n\n来源：https://dydx.exchange/blog/public\n\n<br/>\n\n# 生态\n\n**福布斯杂志以 33 万美元的价格成功拍卖其 NFT 封面**\n\n商业杂志福布斯在 NFT 交易平台 Nifty Gateway 拍卖其 NFT 封面 “Merchants of the Metaverse”，封面中的人物分别为 Cameron 和 Tyler Winklevoss。为期 24 小时的拍卖最后以 333,333 美元的价格被 @mondoir 竞得。\n\n![4](https://i.ibb.co/4YM4G6M/4.png)\n\n来源：https://www.theblockcrypto.com/linked/101144/forbes-nft-winklevoss-auction-ends\n\n\n\n**EthStaker 将举办柏林升级的观看派对**\n\n柏林升级即将在 4 月 14 日启动，届时，EthStaker 将在升级前两个小时举办一场观看派对。链接：https://ethstaker.cc/berlin-upgrade-party/\n\n<br/>\n<br/>\nECN的翻译工作旨在为中国以太坊社区传递优质资讯和学习资源，文章版权归原作者所有，转载须注明原文出处以及ethereum.cn，若需长期转载，请联系eth@ecn.co进行授权。\n\n\n","cover":{"childImageSharp":{"resize":{"src":"/static/66a1b01256795a8db63db75f4e581724/497c6/a8ac179452d4a65b2def3f67474e5186.png"}}}},"site":{"siteMetadata":{"title":"Ethereum Community Network","description":"以太坊——全球的、开源的去中心化应用平台。DeFi？NFT？游戏？虚拟世界？每一个人都可以成为以太坊的开发者和用户！","author":"@ECN以太坊社区网络","keywords":"以太坊,以太坊中国,Ethereum","siteLanguage":"zh-CN","siteLocale":"zh-cn","siteUrl":"http://ethereum.cn","twitterUsername":"@EthereumCN"}}},"pageContext":{"id":"Articles_242"}},"staticQueryHashes":["1238767529","2940180826"]}