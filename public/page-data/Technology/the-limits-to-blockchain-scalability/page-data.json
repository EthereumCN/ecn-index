{"componentChunkName":"component---src-template-article-js","path":"/Technology/the-limits-to-blockchain-scalability","result":{"data":{"strapiArticles":{"title":"Vitalik：区块链可扩展性的限制","summary":"为什么区块链扩容没有我们想得那么容易？","publishDate":"2021-06-04","author":"Vitalik Buterin","authorImg":{"childImageSharp":{"fixed":{"src":"/static/515d00ee55c5d2ee181737cd9a0360fa/8cf18/ce0b14e38f1e7a91610a9ba0f696437a.jpg"}}},"content":"来源 | [vitalik.ca](https://vitalik.ca/general/2021/05/23/scaling.html)\n\n<br/>\n\n*感谢Felix Lange、Martin Swende、Marius van der Wijden 和 Mark Tyneway的反馈和校对。*\n\n\n\n我们能将区块链的可扩展性提升到多少？是否真的能像 [Elon Musk 所说](https://twitter.com/elonmusk/status/1393738154889338884)的那样“区块时间加速十倍，区块大小增长十倍并且手续费降低一百倍”，而不会导致极度中心化并违背区块链的本质属性？如果答案是否定的，那我们能达到什么程度？改变公式算法会怎样？更重要的是，如果引入类似 ZK-SNARK 或分片的功能会怎样？一个分片型的区块链在理论上能够不断添加分片，那么是否真的可以这么做呢？\n\n\n事实证明，无论是否使用分片，都有重要且非常微妙的技术因素限制了区块链的可扩展性。许多情况都有解决方案，但是即使有了解决方案，也存在局限性。这篇文章将探讨其中的许多问题。\n\n\n如果只是简单地拔高参数，问题似乎就能得到解决。但是我们会因此付出什么代价？\n\n![https://vitalik.ca/images/scaling-files/elontweet.png](https://i.ibb.co/HT1p3v9/elontweet.png)\n\n<br/>\n\n# 普通用户能够运行节点对于区块链的去中心化至关重要\n\n想象一下凌晨两点多，你接到了一个紧急呼叫，来自世界另一端帮你运行矿池 (质押池) 的人。从大约 14 分钟前开始，你的池子和其他几个人从链中分离了出来，而网络仍然维持着 79% 的算力。 根据你的节点，多数链的区块是无效的。这时出现了余额错误：区块似乎错误地将 450 万枚额外代币分配给了一个未知地址。\n\n一小时后，你和其他两个同样遭遇意外的小矿池参与者、一些区块浏览器和交易所方在一个聊天室中，看见有人贴出了一条推特的链接，开头写着“宣布新的链上可持续协议开发基金”。\n\n到了早上，相关讨论广泛散布在推特以及一个不审查内容的社区论坛上。但那时 450 万枚代币中的很大一部分已经在链上转换为其他资产，并且进行了数十亿美元的 defi 交易。79％的共识节点，以及所有主要的区块链浏览器和轻钱包的端点都遵循了这条新链。也许新的开发者基金将为某些开发提供资金，或者也许所有这些都被领先的矿池、交易所及其裙带所吞并。但是无论结果如何，该基金实际上都成为了既成事实，普通用户无法反抗。\n\n或许还有这么一部主题电影。或许会由 MolochDAO 或其他组织进行资助。\n\n![https://vitalik.ca/images/scaling-files/forkwars.png](https://i.ibb.co/LxT9XhY/forkwars.png)\n\n这种情形会发生在你的区块链中吗？你所在区块链社区的精英，包括矿池、区块浏览器和托管节点，可能协调得很好，他们很可能都在同一个 telegram 频道和微信群中。如果他们真的想出于利益突然对协议规则进行修改，那么他们可能具备这种能力。以太坊区块链在十小时内完全解决了[共识失败](https://blog.ethereum.org/2016/11/25/security-alert-11242016-consensus-bug-geth-v1-4-19-v1-5-2/)，如果是只有一个客户端实现的区块链，并且只需要将代码更改部署到几十个节点，那么可以更快地协调客户端代码的更改。能够抵御这种社会性协作攻击的唯一可靠方式是“被动防御”，而这种力量来自去一个中心化的群体：用户。\n\n想象一下，如果用户运行区块链的验证节点 (无论是直接验证还是[其他间接技术](https://vitalik.ca/general/2021/04/07/sharding.html#improving-sharding-with-better-security-models))，并自动拒绝违反协议规则的区块，即使超过 90% 的矿工或质押者支持这些区块，故事会如何发展。\n\n如果每个用户都运行一个验证节点，那么攻击很快就会失败：有些矿池和交易所会进行分叉，并且在整个过程中看起来很愚蠢。但是即使只有一些用户运行验证节点，攻击者也无法大获全胜。相反，攻击会导致混乱，不同用户会看到不同的区块链版本。最坏情况下，随之而来的市场恐慌和可能持续的链分叉将大幅减少攻击者的利润。对如此旷日持久的冲突进行应对的想法本身就可以阻止大多数攻击。 \n\nHasu 关于这一点的看法：\n\n“我们要明确一件事，我们之所以能够抵御恶意的协议更改，是因为拥有用户验证区块链的文化，而不是因为 PoW 或 PoS。”\n\n![https://vitalik.ca/images/scaling-files/hasutweet.png](https://i.ibb.co/TWnkZQ7/hasutweet.png)\n\n假设你的社区有 37 个节点运行者，以及 80000 名被动监听者，对签名和区块头进行检查，那么攻击者就获胜了。如果每个人都运行节点的话，攻击者就会失败。我们不清楚针对协同攻击的启动[群体免疫](https://vitalik.ca/general/2020/08/17/philosophy.html)的确切阈值是多少，但有一点是绝对清楚的：好的节点越多，恶意的节点就越少，而且我们所需的数量肯定不止于几百几千个。\n\n<br/>\n\n# 那么全节点工作的上限是什么？\n\n为了使得有尽可能多的用户能够运行全节点，我们会将注意力集中在普通消费级硬件上。即使能够轻松购买到专用硬件，这能够降低一些全节点的门槛，但事实上对可扩展性的提升并不如我们想象的那般。\n\n全节点处理大量交易的能力主要受限于三个方面：\n\n\n- **算力**：在保证安全的前提下，我们能划分多少 CPU 来运行节点？\n\n- **带宽**：基于当前的网络连接，一个区块能包含多少字节？\n\n- **存储**：我们能要求用户使用多大的空间来进行存储？此外，其读取速度应该达到多少？(即，HDD 足够吗？还是说我们需要 SSD？)\n\n\n\n**许多使用“简单”技术对区块链进行大幅扩容的错误看法都源自于对这些数字过于乐观的估计**。我们可以依次来讨论这三个因素：\n\n## 算力\n\n\n- 错误答案：100% 的 CPU 应该用于区块验证\n\n- 正确答案：约 5-10% 的 CPU 可以用于区块验证\n\n\n限制之所以这么低的四个主要原因如下：\n\n\n- 我们需要一个安全边界来覆盖 DoS 攻击的可能性 (攻击者利用代码弱点制造的交易需要比常规交易更长的处理时间)\n\n- 节点需要在离线之后能够与区块链同步。如果我掉线一分钟，那我应该要能够在几秒钟之内完成同步\n\n- 运行节点不应该很快地耗尽电池，也不应该拖慢其他应用的运行速度\n\n- 节点也有其他非区块生产的工作要进行，大多数是验证以及对 p2p 网络中输入的交易和请求做出响应\n\n\n请注意，直到最近大多数针对“为什么只需要 5-10%？”这一点的解释都侧重于另一个不同的问题：因为 PoW 出块时间不定，验证区块需要很长时间，会增加同时创建多个区块的风险。 这个问题有很多修复方法，例如 [Bitcoin NG](https://www.usenix.org/system/files/conference/nsdi16/nsdi16-paper-eyal.pdf)，或使用 PoS 权益证明。但这些并没有解决其他四个问题，因此它们并没有如许多人所料在可扩展性方面获得巨大进展。\n\n\n并行性也不是灵丹妙药。通常，即使是看似单线程区块链的客户端也已经并行化了：签名可以由一个线程验证，而执行由其他线程完成，并且有一个单独的线程在后台处理交易池逻辑。 而且所有线程的使用率越接近 100%，运行节点的能源消耗就越多，针对 DoS 的安全系数就越低。\n\n## 带宽\n\n\n- **错误答案**：如果没 2-3 秒都产生 10 MB 的区块，那么大多数用户的网络都大于 10 MB/秒，他们当然都能处理这些区块\n\n- **正确答案**：或许我们能在每 12 秒处理 1-5 MB 的区块，但这依然很难\n\n\n如今，我们经常听到关于互联网连接可以提供多少带宽的广为传播的统计数据：100 Mbps 甚至 1 Gbps 的数字很常见。但是由于以下几个原因，宣称的带宽与预期实际带宽之间存在很大差异：\n\n1.  “Mbps”是指“每秒数百万 bits”； 一个 bit 是一个字节的 1/8，因此我们需要将宣称的 bit 数除以 8 以获得字节数。\n2.  网络运营商，就像其他公司一样，经常编造谎言。\n3.  总是有多个应用使用同一个网络连接，所以节点无法独占整个带宽。\n4.  P2P 网络不可避免地会引入开销：节点通常最终会多次下载和重新上传同一个块 (更不用说交易在被打包进区块之前还要通过 mempool 进行广播)。\n\n\n当 Starkware 在 2019 年进行一项实验时，他们在[交易数据 gas 成本降低](https://eips.ethereum.org/EIPS/eip-2028)后首次发布了 500 kB 的区块，一些节点实际上无法处理这种大小的区块。处理大区块的能力已经并将持续得到改善。但是无论我们做什么，我们仍然无法获取以 MB/秒为单位的平均带宽，说服自己我们可以接受 1 秒的延迟，并且有能力处理那种大小的区块。\n\n## 存储\n\n\n- **错误答案**：10 TB\n\n- **正确答案**：512 GB\n\n\n\n正如大家可能猜到的，这里的主要论点与其他地方相同：理论与实践之间的差异。理论上，我们可以在亚马逊上购买[ 8 TB 固态驱动](https://www.amazon.com/SAMSUNG-870-QVO-SATA-MZ-77Q8T0B/dp/B089C3TZL9/ref=sr_1_3?dchild=1&keywords=8tb&qid=1621637865&s=pc&sr=1-3) (确实需要 SSD 或 NVME；HDD 对于区块链状态存储来说太慢了)。实际上，我用来写这篇博文的笔记本电脑有 512 GB，如果你让人们去购买硬件，许多人就会变得懒惰 (或者他们无法负担 800 美元的 8 TB SSD) 并使用中心化服务。即使可以将区块链装到某个存储设备上，大量活动也可以快速地耗尽磁盘并迫使你购入新磁盘。\n\n一群区块链协议研究员对每个人的磁盘空间进行了调查。 我知道样本量很小，但仍然...\n\n![https://vitalik.ca/images/scaling-files/poll.png](https://i.ibb.co/gjDNpgS/poll.png)\n\n此外，存储大小决定了新节点能够上线并开始参与网络所需的时间。现有节点必须存储的任何数据都是新节点必须下载的数据。这个初始同步时间 (和带宽) 也是用户能够运行节点的主要障碍。在写这篇博文时，同步一个新的 geth 节点花了我大约 15 个小时。如果以太坊的使用量增加 10 倍，那么同步一个新的 geth 节点将至少需要一周时间，而且更有可能导致节点的互联网连接受到限制。这在攻击期间更为重要，当用户之前未运行节点时对攻击做出成功响应需要用户启用新节点。\n\n## 交互效应\n\n此外，这三类成本之间存在交互效应。由于数据库在内部使用树结构来存储和检索数据，因此从数据库中获取数据的成本随着数据库大小的对数而增加。事实上，因为顶级 (或前几级) 可以缓存在 RAM 中，所以磁盘访问成本与数据库大小成正比，是 RAM 中缓存数据大小的倍数。\n\n不要从字面上理解这个图，不同的数据库以不同的方式工作，通常内存中的部分只是一个单独 (但很大) 的层 (参见 leveldb 中使用的 [LSM 树](http://paperhub.s3.amazonaws.com/18e91eb4db2114a06ea614f0384f2784.pdf))。但基本原理是一样的。\n\n![https://vitalik.ca/images/scaling-files/tree.png](https://i.ibb.co/BchsfNs/tree.png)\n\n\n例如，如果缓存为 4 GB，并且我们假设数据库的每一层比上一层大 4 倍，那么以太坊当前的 ~64 GB 状态将需要 ~2 次访问。但是如果状态大小增加 4 倍到 ~256 GB，那么这将增加到 ~3 次访问。 因此，gas 上限增加 4 倍实际上可以转化为区块验证时间增加约 6 倍。这种影响可能会更大：硬盘在已满状态下比空闲时需要花更长时间来读写。\n\n## 这对以太坊来说意味着什么？\n\n现在在以太坊区块链中，运行一个节点对许多用户来说已经是一项挑战，尽管至少使用常规硬件仍然是可能的 (我写这篇文章时刚刚在我的笔记本电脑上同步了一个节点！)。 因此，我们即将遭遇瓶颈。**核心开发者最关心的问题是存储大小。**因此，目前在解决计算和数据瓶颈方面的巨大努力，甚至对共识算法的改变，都不太可能带来 gas limit 的大幅提升。即使[解决了以太坊最大的 DoS 弱点](https://blog.ethereum.org/2021/05/18/eth_state_problems/)，也只能将 gas limit 提高 20%。\n\n对于存储大小的问题，唯一解决方案是[无状态和状态逾期](https://hackmd.io/@vbuterin/state_expiry_paths)。无状态使得节点群能够在不维护永久存储的情况下进行验证。状态逾期会使最近未访问过的状态失活，用户需要手动提供证明来更新。这两条路径已经研究了很长时间，并且已经开始了关于无状态的概念验证实现。这两项改进相结合可以大大缓解这些担忧，并为显著提升 gas limit 开辟空间。**但即使在实施无状态和状态逾期之后，gas limit 也可能只会安全地提升约 3 倍，直到其他限制开始发挥作用。**\n\n另一个可能的中期解决方案使使用 ZK-SNARKs 来验证交易。ZK-SNARKs 能够保证普通用户无需个人存储状态或是验证区块，即使他们仍然需要下载区块中的所有数据来抵御[数据不可用攻击](https://github.com/ethereum/research/wiki/A-note-on-data-availability-and-erasure-coding)。另外，即使攻击者不能强行提交无效区块，但是如果运行一个共识节点的难度过高，依然会有协调审查攻击的风险。因此，ZK-SNARKs 不能无限地提升节点能力，但是仍然能够对其进行大幅提升 (或许是 1-2 个数量级)。一些区块链在 layer1 上探索该形式，以太坊则通过 layer2 协议 (也叫 [ZK rollups](https://vitalik.ca/general/2021/01/05/rollup.html)) 来获益，例如 [zksync](https://zksync.io/), [Loopring](https://loopring.org/) 和 [Starknet](https://medium.com/starkware/on-the-road-to-starknet-a-permissionless-stark-powered-l2-zk-rollup-83be53640880)。\n\n<br/>\n\n# 分片之后又会如何？\n\n\n**分片从根本上解决了上述限制，因为它将区块链上包含的数据与单个节点需要处理和存储的数据解耦了**。节点验证区块不是通过亲自下载和执行，而是使用[先进的数学和密码学技术](https://vitalik.ca/general/2021/04/07/sharding.html)来间接验证区块。\n\n因此，分片区块链可以安全地拥有非分片区块链无法实现的非常高水平的吞吐量。这确实需要大量的密码学技术来有效替代朴素完整验证，以拒绝无效区块，但这是可以做到的：[该理论](https://hackmd.io/@vbuterin/das)已经[具备了基础](https://vitalik.ca/general/2021/01/26/snarks.html)，并且基于[草案规范](https://github.com/ethereum/eth2.0-specs/blob/dev/specs/sharding/beacon-chain.md)的概念验证[已经在进行中](https://github.com/protolambda/eth2-das)。\n\n![https://vitalik.ca/images/sharding-files/beacon_chain.jpg](https://i.ibb.co/Tbbpckf/beacon-chain.jpg)\n\n以太坊计划采用**二次方分片 (quadratic sharding)**，其中总可扩展性受到以下事实的限制：节点必须能够同时处理单个分片和信标链，而信标链必须为每个分片执行一些固定的管理工作。如果分片太大，节点就不能再处理单个分片，如果分片太多，节点就不能再处理信标链。这两个约束的乘积构成了上限。\n\n\n可以想象，通过三次方分片甚至指数分片，我们可以走得更远。在这样的设计中，数据可用性采样肯定会变得更加复杂，但这是可以实现的。 但以太坊并没有超越二次方，原因在于，从交易分片到交易分片的分片所获得的额外可扩展性收益实际上无法在其他风险程度可接受的前提下实现。\n\n那么这些风险是什么呢？\n\n## 最低用户数量\n\n可以想象，只要有一个用户愿意参与，非分片区块链就可以运行。但分片区块链并非如此：单个节点无法处理整条链，因此需要足够的节点以共同处理区块链。 如果每个节点可以处理 50 TPS，而链可以处理 10000 TPS，那么链至少需要 200 个节点才能存续。如果链在任何时候都少于 200 个节点，那可能会出现节点无法再保持同步，或者节点停止检测无效区块，或者还可能会发生许多其他坏事，具体取决于节点软件的设置。\n\n在实践中，由于需要冗余 (包括[数据可用性采样](https://hackmd.io/@vbuterin/das))，安全的最低数量比简单的“链 TPS 除以节点 TPS”高几倍，对于上面的例子，我们将其设置位 1000 个节点。\n\n如果分片区块链的容量增加 10 倍，则最低用户数也增加 10 倍。 现在大家可能会问：为什么我们不从较低的容量开始，当用户很多时再增加，因为这是我们的实际需要，用户数量回落再降低容量？\n\n\n这里有几个问题：\n\n1. 区块链本身无法可靠地检测到其上有多少唯一用户，因此需要某种治理来检测和设置分片数量。对容量限制的治理很容易[成为分裂和冲突的根源。](https://en.bitcoin.it/wiki/Block_size_limit_controversy)\n2. 如果许多用户突然同时意外掉线怎么办？\n3.增加启动分叉所需的最低用户数量，使得防御恶意控制更加艰难。\n\n\n\n最低用户数为 1,000，这几乎可以说是没问题的。另一方面，最低用户数设为 100 万，这肯定是不行。即使最低用户数为 10,000 也可以说开始变得有风险。**因此，似乎很难证明超过几百个分片的分片区块链是合理的。**\n\n## 历史可检索性\n\n\n\n用户真正珍视的区块链重要属性是**永久性**。当公司破产或是维护该生态系统不再产生利益时，存储在服务器上的数字资产将在 10 年内不再存在。而以太坊上的 NFT 是永久的。\n\n\n\n是的，到 2372 年人们仍能够下载并查阅你的加密猫。\n\n![https://vitalik.ca/images/scaling-files/cryptokitties.png](https://i.ibb.co/q1yrLZF/cryptokitties.png)\n\n\n但是一旦区块链的容量过高，存储所有这些数据就会变得更加困难，直到某时出现巨大风险，某些历史数据最终将……没人存储。\n\n\n要量化这种风险很容易。以区块链的数据容量 (MB/sec) 为单位，乘以 ~30 得到每年存储的数据量 (TB)。 当前的分片计划的数据容量约为 1.3 MB/秒，因此约为 40 TB/年。如果增加 10 倍，则为 400 TB/年。如果我们不仅希望可以访问数据，而且是以一种便捷的方式，我们还需要元数据 (例如解压缩汇总交易)，因此每年达到 4 PB，或十年后达到 40 PB。Internet Archive (互联网档案馆) [使用 50 PB](https://archive.org/web/petabox.php)。所以这可以说是分片区块链的安全大小上限。\n\n\n因此，看起来在这两个维度上，**以太坊分片设计实际上已经非常接近合理的最大安全值**。常数可以增加一点，但不能增加太多。\n\n<br/>\n\n# 结语\n\n尝试扩容区块链的方法有两种：**基础的技术改进和简单地提升参数。**首先，提升参数听起来很有吸引力：如果您是在餐纸上进行数学运算，这就很容易让自己相信消费级笔记本电脑每秒可以处理数千笔交易，不需要 ZK-SNARK、rollups 或分片。不幸的是，有很多微妙的理由可以解释为什么这种方法是有根本缺陷的。\n\n运行区块链节点的计算机无法使用 100％的 CPU 来验证区块链；他们需要很大的安全边际来抵抗意外的 DoS 攻击，他们需要备用容量来执行诸如在内存池中处理交易之类的任务，并且用户不希望在计算机上运行节点的时候无法同时用于任何其他应用。带宽也会受限：10 MB/s 的连接并不意味着每秒可以处理 10 MB 的区块！也许每 12 秒才能处理 1-5 MB 的块。存储也是一样，提高运行节点的硬件要求并且限制专门的节点运行者并不是解决方案。**对于去中心化的区块链而言，普通用户能够运行节点并形成一种文化，即运行节点是一种普遍行为，这一点至关重要。**\n\n\n然而，基础的技术改进是可行的。当前，**以太坊的主要瓶颈是存储大小，而无状态性和状态逾期可以解决该问题，**并使其能够最多增长约 3 倍，但不能再多，因为我们希望运行节点比当前更容易。**采用分片的区块链可以进一步扩展**，因为分片区块链中的单个节点不需要处理每笔交易。但即使是分片区块链，容量也有局限性：随着容量的增加，最低安全用户数增加，归档区块链的成本 (以及如果没有人归档链，数据存在丢失的风险) 就会上升。但是我们不必过于担心：这些限制足以我们在保证区块链完全安全性的同时每秒处理一百万笔交易以上。但是要在不损害区块链最宝贵的去中心化特性的前提下实现这一点，我们需要付出更多努力。\n\n<br/>\n<br/>\nECN的翻译工作旨在为中国以太坊社区传递优质资讯和学习资源，文章版权归原作者所有，转载须注明原文出处以及ethereum.cn，若需长期转载，请联系eth@ecn.co进行授权。","cover":{"childImageSharp":{"resize":{"src":"/static/a8ce188f83f382dae16ba9bdd7703655/497c6/abd7452774fe86d85ae7c25afffef78d.png"}}}},"site":{"siteMetadata":{"title":"Ethereum Community Network","description":"以太坊——全球的、开源的去中心化应用平台。DeFi？NFT？游戏？虚拟世界？每一个人都可以成为以太坊的开发者和用户！","author":"@ECN以太坊社区网络","keywords":"以太坊,以太坊中国,Ethereum","siteLanguage":"zh-CN","siteLocale":"zh-cn","siteUrl":"http://ethereum.cn","twitterUsername":"@EthereumCN"}}},"pageContext":{"id":"Articles_276"}},"staticQueryHashes":["1238767529","2940180826"]}