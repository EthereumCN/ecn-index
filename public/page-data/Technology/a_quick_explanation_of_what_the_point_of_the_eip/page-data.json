{"componentChunkName":"component---src-template-article-js","path":"/Technology/a_quick_explanation_of_what_the_point_of_the_eip","result":{"data":{"strapiArticles":{"title":"Vitalik: 柏林升级里， EIP-2929 提高 gas 开销有何意义？","summary":"Vitalik 简单阐述 EIP-2929 提高 gas 开销对以太坊安全性的意义","publishDate":"2021-04-23","author":"Vitalik Buterin","authorImg":{"childImageSharp":{"fixed":{"src":"/static/515d00ee55c5d2ee181737cd9a0360fa/8cf18/ce0b14e38f1e7a91610a9ba0f696437a.jpg"}}},"content":"来源 | [r/ethereum](https://www.reddit.com/r/ethereum/comments/mrl5wg/a_quick_explanation_of_what_the_point_of_the_eip/)\n\n<br/>\n\n摘要: \n\n- 是的，某些操作码调用将需要更多的 gas 开销，但必须这样做来提高安全性。\n- 但另一方面，一直以来应该更便宜的操作 (存储后加载相同的 slot) 最终会变得更便宜。\n- 另一个重要裨益是，适度提高 gas limit 现在变得更安全。现在限制 gas limit 提高的主要原因跟多在于状态大小问题。\n\n\n柏林硬分叉中引起 gas 开销变化的 EIP 有：[EIP 2565](https://eips.ethereum.org/EIPS/eip-2565) (降低`ModExp` 求模求幂运算的 gas 开销 )、[EIP 2929](https://eips.ethereum.org/EIPS/eip-2929) (提高`SLOAD` 与 `CALL` 的 gas 开销)、以及 EIP [2718](https://eips.ethereum.org/EIPS/eip-2718) 和 [2930](https://eips.ethereum.org/EIPS/eip-2930)，用以支持受 gas 开销增加影响的合约的兼容性，以及为未来的升级铺垫。\n\n目前，这些 EIP 中最重要的是 EIP-2929。它的核心内容是： `SLOAD` 的 gas 开销从 800 增加到 2100，`CALL` 的 gas 开销 (包括`STATICCALL` 、 `DELEGATECALL`和其他操作码) 以及外部合约查询 (`BALANCE`、`EXTCODESIZE` 等) 从 700 增加到 2600，但这种情况仅会在地址和存储 slot 在交易里首次被访问时发生。\n\n这样做的目的是进一步提高对 DoS 攻击的抵御能力：早期的研究显示，以太坊协议目前最大的 DoS 漏洞在存储访问，而且是有可能可以创建一些区块对大量账户作简单重复的访问，处理时间可能长达 80 秒。解决办法是一个简单的快速修复：使这些操作持续更长的时间 (存储访问需要磁盘访问) 以消耗更多的 gas，最终 DoS 问题会被削弱大概 3 倍。与此同时，客户端团队进行了一些出色的工作——实现磁盘存储缓存、减少存储加载所需的数据库查询次数、以及更长远地堵住这个漏洞。\n\n\ngas 开销重新定价加上这些客户端的改善使得现有的区块链更安全，也使得提供 gas limit 比现在更加安全。在 EIP-2929 后，避免大幅 gas limit 提升的主要原因实际上不再是 DoS 攻击问题，而是状态大小的增加 (这两方面互相影响：当存储负载变大后存储加载消耗的 gas 会更多)。因此，[状态过期和无状态](https://hackmd.io/@vbuterin/state_expiry_paths)会变得非常重要，甚至可以说是“合并” 后的首要任务。\n\n这次的重新定价产生的第二大长期裨益是[无状态验证](https://dankradfeist.de/ethereum/2021/02/14/why-stateless.html)的见证大小理论上最大能减少 3 倍。对于代码读取，我们还需要一次重新定价 (类似于：每访问 31 字节代码需要 500 gas)，但这一点可以在未来实现。\n\n请注意：这份 EIP 只增加每笔交易第一次访问的 gas 开销。往后的访问实际上是更便宜的 (任何情况下都是 100 gas)。另外，对预编译的调用一直只消耗 100 gas，包括首次调用。这样做有带来以下正面影响：\n\n- 在同一个 slot 里，任何`SLOAD` 后的 `SSTORE` (或者  `SSTORE` 后的 `SLOAD` ) 都会变得更便宜。这是因为第一次存储读取或写入以及支付了访问存储 slot 的 gas 费了，因此该存储 slot 已经“预热了”，第一次读取和写入都会更便宜；这样，我们需要支付的 gas 不是 800 + 5000，而是 2100 + 2900 (大约)，减少了大约 800 gas。这可能使采用 ERC20 协议标准代币的转发更便宜。\n- Self-calling 变得更便宜\n- 对预编译的调用变得更便宜 (这对于低 gas 开销的预编译来说特别有价值，这些预编译需要倍调用非常多次，比如 `ECADD`)\n\n添加第一次访问规则是因为当一个账户或存储 slot 被第二次访问时，该账户或存储 slot 应该已经在内容里有缓存了，因此就不需要进行昂贵的磁盘访问了。当然，对同一个数值的两次访问也只需要一次的见证条目。\n\n<br/>\n<br/>\nECN的翻译工作旨在为中国以太坊社区传递优质资讯和学习资源，文章版权归原作者所有，转载须注明原文出处以及ethereum.cn，若需长期转载，请联系eth@ecn.co进行授权。\n\n","cover":{"childImageSharp":{"resize":{"src":"/static/5d3dffc3694860ef671d63aae2183d22/497c6/dbb44965b10c70d3eba5eb82afcae5e2.png"}}}},"site":{"siteMetadata":{"title":"Ethereum Community Network","description":"以太坊——全球的、开源的去中心化应用平台。DeFi？NFT？游戏？虚拟世界？每一个人都可以成为以太坊的开发者和用户！","author":"@ECN以太坊社区网络","keywords":"以太坊,以太坊中国,Ethereum","siteLanguage":"zh-CN","siteLocale":"zh-cn","siteUrl":"http://ethereum.cn","twitterUsername":"@EthereumCN"}}},"pageContext":{"id":"Articles_250"}},"staticQueryHashes":["1238767529","2940180826"]}