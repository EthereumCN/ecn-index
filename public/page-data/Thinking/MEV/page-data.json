{"componentChunkName":"component---src-template-article-js","path":"/Thinking/MEV","result":{"data":{"strapiArticles":{"title":"关于MEV的一切","summary":"何为MEV、MEV的影响、如何解决MEV问题","publishDate":"2021-02-10","author":"Charlie Noyes","authorImg":{"childImageSharp":{"fixed":{"src":"/static/f935a55dc167080886006f1c62c94e0a/2244e/54c12d53402f88d39e2ad586ae76cb43.jpg"}}},"content":"来源 | [Paradigm Research](https://research.paradigm.xyz/MEV)\n\n以太坊的核心在于， 利用其灵活的智能合约允许开发者探索无需许可应用程序的新领域。建立在以太坊上的去中心化金融协议 (DeFi) 正爆炸性增长，我们从中瞥见未来该创新可以给我们带来什么。\n\n正如第一次互联网革命中的编程库一样，DeFi 作为“金钱乐高”允许开发者通过组合与混用简单的区块来构建出复杂的系统。这种复杂性也会带来新的风险。风险之一就是矿工可提取价值 (Miner Extractable Value, 简称MEV)。\n\n<br/>\n\n# 矿工可提取价值\n\n矿工可提取价值 这一概念由 Phil Daian 在文章 [Flash Boys 2.0](https://arxiv.org/abs/1904.05234) 中首先提出。最近，我的搭档 Dan Robinson、Georgios Konstantopoulos 以及 samczsun 在文章 《[以太坊是一片黑暗森林](https://medium.com/@danrobinson/ethereum-is-a-dark-forest-ecc5f0505dff)》和《[逃离黑暗森林](https://samczsun.com/escaping-the-dark-forest/)》中再次科普了 MEV 这一概念。\n\nMEV 已然成为加密经济学的一个基本概念，但究竟何为 MEV？它会给无需许可的区块链带来什么影响？\n\n<br/>\n\n# MEV 是什么？\n\n矿工 (或验证者、序列器) 在其生产的区块中通过其能力任意打包、排除或重新排序交易可以获得一定的利润，而 MEV 便是衡量该利润的一种度量。\n\n假设在 Uniswap 上有一笔大宗交易产生滑点之后，出现了一个价值一万美元的套利机会。这时，套利机器人注意到了这个套利机会并提交一笔交易以捕捉机会，提供给矿工的交易费为 10 美元。那么可能会出现以下情况：\n\n1.  矿工会复制和审查套利者的交易以便自己捕捉此次套利机会；\n\n2. 其他机器人也会注意到该次套利机会并提供更高的交易费报价，因此导致大家竞价以争取捕捉套利机会的权力。这种竞拍模式被称为“优先 Gas 拍卖” (Priority Gas Auction, PGA)。\n\n上面提到的一万美元潜在收益便是 MEV。如果矿工没有捕捉这个套利机会，但是发生了 PGA，那么获胜交易者所获得的利润为：MEV 总值 - gas竞拍结算价。(e.g. 如果付 7000 美元给矿工，那么剩下的 3000 美元就是交易者利润)。\n\n这个例子让我们得以窥探 MEV 涵义，但并没有描述出其全貌。MEV 并非罕见。这种金融小游戏带来的激励，会产生一系列因果连锁反应，必须密切追踪才能看到其中的关联。本文将探讨这个话题并解释为什么 MEV 可能会危害以太坊及其用户。\n\n![alt_text](https://i.ibb.co/jH0sd7H/testgraph.png)\n\nDeFi 的成功带来最直接的影响便是：以太坊 MEV 的已知下限正呈指数增长。按照这个速度，相信 MEV 在接下来一年会产生实际性的问题。\n\n<br/>\n\n# MEV 的状况\n\n我们不可能判断以太坊上的 MEV 总共有多少。我们目前知道的所有 MEV 仅为下限值。\n\n这是因为 MEV 可以在用户与区块链交互的任意时间被创建，并且智能合约允许实现无限数量的潜在交互。因此，无法通过单纯的计算得出区块链上潜在的 MEV 总值。\n\n然而，我们可以通过相加已知被利用的 MEV (即上图所示的 “已实现的 MEV”) 来建立基线。然后，我们便可以使用启发式的方法来推断真实的下限值比我们的基线高出多少，以及未被利用的 MEV 会如何影响区块链的环境。\n\n<br/>\n\n# 当前的 MEV\n\n目前以太坊上的状况是，大部分矿工 (还) 没有尝试过自己捕获 MEV。几乎所有当前的链上活动都是由非矿工交易者推动的。然而，一些 MEV 只能由矿工捕获，因为他们有权任意排序 (或排除) 交易。非矿工交易者可以捕获“简单”的 MEV；而较为“复杂”的 MEV 无法通过 PGA 捕获。\n\n这意味着我们目前看到的大多数是 PGA 类型的 MEV。就像上面提到的例子一样，Uniswap 套利是最常见的 MEV 实现方式。\n\n\n另一种常见的 MEV 类型便是从易受攻击的智能合约中进行盗窃。Dan 等人在文章 《黑暗森林》中描述了一个例子。他们发现了一个有漏洞的智能合约，允许任何人从中盗取资金；Dan 计划在黑客之前利用漏洞追回资金。然而，一个套利机器人自动识别并复制了 Dan 的交易，用自己的地址代替了 Dan 的地址并提供更高的交易费。套利机器人的交易在 Dan 之前被执行，从而挪走了他们的资金。\n\n<br/>\n\n# 未来的 MEV\n\n当以太坊上的矿工开始大量地捕获 MEV 时，MEV 的下一个时代便来临了。然而，目前为止，社区共同的假设为：矿工遵循利他主义，会主动放弃 MEV 利润并继续运行默认的节点软件。比特币矿工根据经验没有选择自私挖矿策略，因此前者所作的假设是有例子可循的。\n\n然而根据过去三个月的观察，我们认为这种“矿工利他主义”假设是行不通的。我们发现网络上有一小部分但值得注意的哈希率正在[捕获 MEV](https://oko.palkeo.com/11708078/)，[刮分非矿工交易者的部分利润，而不是允许无须许可的费用竞拍](https://twitter.com/bantg/status/1349470728320659456?s=20)，还有[把准入许可卖给私人交易池](https://www.rekt.news/return-to-the-dark-forest/)。\n\n相反，我们相信 MEV 正逐渐突破矿工的心理防线。首先，狂热的非挖矿交易者在链上的频繁活动给矿工带来了更加客观的 MEV 捕获机会。再者，非挖矿交易者所不能捕获的 MEV 类型是完全未受挖掘的金库；而这个金库比目前为止我们所知道的 MEV 要大得多。在某种程度上，更令人惊讶的是，矿工花了这么长时间才参与进来。\n\n大坝很可能已经决堤：矿工们会更加深入该领域，探索更加独特的 MEV 和合谋形式。以太坊及其用户可能会面临巨大的风险。\n\n\n接下来的部分会详细解释将来可能会带来什么，从我们提到的 MEV 的潜在“风险”开始。\n\n## MEV Can Harm Users  MEV 会危害用户\n\nMEV 可以看作是矿工对用户收取的税 (无形的)。\n\n\n在上面提到的 Uniswap 例子中，一笔大宗交易会导致价格滑点，产生价值一万美元的套利机会 (MEV)。套利机器人通过套利行为使得市场价与真实价格持平，这使 Uniswap 市场在不伤害原始交易者的同时变得更加高效。这个 MEV 交易例子是良性的。\n\n然而，同样是这笔交易的另一个版本将会是这样：一个套利机器人在执行之前就识别到用户的交易，然后将用户的交易夹在自己的买卖订单中间。最终的结果便是，MEV 向用户征收了一种无形的税：他们的订单被人为抬高而导致无法执行，然后套利机器人立即出售订单以获取利润。当然，矿工可以零成本做到这一点。这种 MEV 交易就是恶性的。\n\n<br/>\n\n# MEV 会危害以太坊\n\nMEV 本质上助长了共识的不稳定性。\n\n假设有两名矿工 Sam 和 Dan，他们生产每一个区块都能获取 100 美元的报酬。Sam 生成了 3 个区块，而第一个就包括 Uniswap 上价值一万美元的套利机会。\n\n现在，Dan 需做出选择：要么接着 Sam 的区块往后面挖，也可以尝试重新挖第一个区块以抢夺 Uniswap 上的套利机会。一万美元比一百美元的区块奖励要诱人，理性上 Dan会倾向后者。\n\n由于目前最长链为区块高度 3，Dan 也要重挖第二和第三个区块 (并捕获这些区块中的任何 MEV)。在重组后，Dan 拥有最长链，他和 Sam 就可以从第三个区块继续挖了。\n\n这被称为“时间盗贼”攻击：如果区块奖励比 MEV 小得多时，矿工足以合理地破环共识。\n\n我们的例子只基于两方来假设。而在一个真实的多玩家游戏世界中，很有可能每一个矿工都会遵循理性而尝试重组第三个区块，从而从根本上停止进程。然而，这会摧毁矿工的哈希率投资价值。如果我们看到这种行为，那么这很有可能会以更加频繁、更加快速的重组形式出现，尽管这些重组不会完全使得网络停止发展。\n\n<br/>\n\n# MEV 是以太坊独有的吗？\n\nMEV 并非以太坊所独有的，理论上比特币网络上也会有 MEV。审查闪电网络通道或者双花染色币所获得的激励就属于 MEV。[1] 然而，我们假设比特币本质上比以太坊这样的区块链更少出现 MEV 的可能性。\n\n原因在于两种区块链的”复杂性“和”状态性“\n\n1.  MEV 在给定区块链上积累的速率通常与其应用层行为的复杂性成正比。\n\n2.  像以太坊这样任意性和灵活性较强的协议，无法逃离这种复杂性，并且趋于复杂是其本质所然。\n\n3.  如果不改变以太坊的用户体验，就无法轻易减少 MEV 激励。\n\n这就是为什么我们说\"以太坊所固有的复杂性可能是一个诅咒\"。\n\n## MEV 与复杂性相伴\n\n从纯理论的角度来看，即使是比特币也无法限制其中出现潜在的 MEV。然而，比特币本身的设计使得意外的高-MEV 案例较少出现，实际上，几乎很少见到。这种情况未来似乎不会改变，因此我们认为 MEV 不会成为比特币较大的威胁 (通胀是另一个问题 [2])。\n\n对比之下，我们可以观察到以太坊上的 MEV 正呈指数增长，这是由于 DeFi 应用带来的巨大价值流。那些看起来如此有前途的金融基元，同时也可以被视作以太坊的寄生虫：它们正编织着一张巨大的 MEV 网络，而该网络会日益变大、变复杂。\n\n## 以太坊无法限制复杂性\n\n如果闪电网络在比特币上创造了 MEV (实际上威胁着比特币的共识稳定性)，我们可以以相对简单的方式，从比特币的有限规则集 (脚本) 中删除掉创建支付通道所需的操作码。\n\n另一方面，如果我们发现一些应用模式 (如DEX、借贷、代币化的托管资产等) 对以太坊造成了类似的风险，那么我们不可能在 EVM 上排查所有可能的实现方式。个别的实现方式可能会分叉，但是如果我们不允许合约部署或者不严格限制 EVM，我们就无法阻止一般的行为。无论是哪种情况，以太坊都无法实现”无需许可智能合约“。\n\n## 难以解决\n\n最后，人们自然会问，以太坊上是否可以构建一种机制来抵消协议中 MEV 的影响。简而言之，不可以，至少在不影响以太坊开发者或用户体验的前提下，是无法办到的。\n\n任何阻止矿工从 MEV 中获益的尝试都可能催生协议外的市场。比如，如果所有交易都仅允许按照一个固定的费率支付，我们可以预想到矿工可能会和交易者合谋，接受带外的 (out-of-hand) 交易优先级交易。同样，如果所有交易费都被销毁或支付给一个公共接收方，那么矿工就会单独地收取交易费。\n\n这就是为什么无法轻易缓解 MEV 问题。当然现在存在着潜在的缓解措施，但是需要进行结构性的改变，如改变以太坊应用的架构和用户与其交互的方式。\n\n<br/>\n\n# 总结\n\n如果比特币的激励安全机制失败了，至少在区块链奖励归零之前，难以想象任何无需许可的区块链不会遭受类似的命运。比特币的简洁性不仅美观优雅，而且还最大限度地减少其协议外的激励面。\n\n相比之下我们更加担心以太坊。以太坊的应用层复杂性和 MEV 继续呈指数增长。而已知的 MEV 收益最低值可能比该年度的矿工维持网络安全所获得激励的 ETH 总值。\n\n大规模、有效的 MEV 捕获会使得对以太坊用户征”税“这种模式难以维持。以太坊可能会变得拥挤不堪，应用层上的交易费更加昂贵。平台的用户体验受到损害，这一切都会阻碍以太坊的网络效应和发展势头。\n\n当然，一个主要的未知点是，以太坊矿工是否会开始大量地捕获 MEV。矿工可以获得本属于非挖矿交易者的 MEV，并以最大的效率捕获其所有值，因此这对于成本和用户体验来说是灾难性的。\n\n”时间盗贼“攻击也有可能出现，虽然矿工不太可能通过大规模重组来损害他们在以太坊上的长期利益。另一个简易的攻击版本，矿工可能故意打包叔块或者重组一小部分利润丰厚的区块，这种方式仍然十分有害。\n\n无论如何，我们是时候认真考虑如果情况恶化，该采取什么方式应对了。\n\n<br/>\n\n# 缓解 MEV 问题\n\n一个理想的解决方案将减少以太坊上的 MEV，或者在不增加通货膨胀的情况下提高矿工维护网络安全的激励:\n\n1. 更佳的应用设计：每个应用程序都可以自己设计，以最小化其能够创造的 MEV。这一方案可能很有竞争优势，因为用户将需要支付更低的成本和享受更好的用户体验。然而，协议不能强制应用程序这样做，并且可避免的 MEV 非常有限。\n\n2. 额外的安全性激励：除了区块奖励之外 (如 EIP-1559 提议销毁的 BASEFEEs[3]，或状态租金)，稳定的矿工收入来源是对协议安全的补充，并可以帮助缓解 MEV 问题。\n\n如果不考虑上面的两个方案，大多数研究就会集中于如何提高破坏共识 (时间盗贼攻击) 的难度和成本，而不是从根源上解决 MEV 问题：\n\n1. 分离打包和排序：矿工 (或验证者) 只能负责打包交易，而将优先交易排序的权利单独竞拍。理论上，这防止重组激励。然而，这使得用户总是需要承受优先交易竞拍带来的 MEV 损失，这等同于多区块时间盗贼攻击带来的影响。\n\n2.  最终确定性 (Finality)：中本聪的工作量证明 (PoS) 只有概率上的最终确定性。而基于拜占庭容错的算法更能保证最终确定性，并且仅仅重组单个被敲定的区块就需要程度更深的合谋，该算法使得时间盗贼攻击更加困难。然而，如果 MEV 的激励足够高，那么即使合谋的难度较高也值得尝试了。再者，参与者对于其提议的区块，仍然有权任意排序交易，因此仅凭最终确定性无法解决“一般”的抢跑交易问题。\n\n3.  权益证明 (Proof-of-Stake)：基于 PoS 的区块链中，尝试重组的验证者会遭受罚没惩罚，因此使得时间盗贼攻击成本更高，尤其是与最终确定性结合时。然而，只要 MEV 的激励足够高，即使在罚没惩罚的警示下也可能会捕获 MEV。\n\n以上所有方法对以太坊生态都会产生重要的影响。许多涉及核心协议的改变需要数年的时间来实现。那些只能在应用层完成的操作仍需要开发者重新架构，并且将大部分生态迁移到其他环境中。\n\n希望接下来的一年会有更加明朗的方案以解决 MEV 问题，以太坊的发展路线将更清晰。Paradigm 的一些投资组合公司正努力解决 MEV 以及相关问题，如果大家感兴趣，可以关注一下。\n\n## Rollup\n\nRollups 已然成为以太坊主要的二层扩容解决方案。虽然有不同的 rollup 解决方案，但总的来说就是，允许一个聚合器在链下执行应用，然后向以太坊广播证明欺诈 (或除欺诈以外) 所需要的最低限度的信息。Rollup 在保证安全的情况下实现低延迟和高吞吐量。\n\n除了提供扩容解决方案，rollups 还可以使得交易排序和执行分离 (参见 Optimism 的“[MEV 竞拍](https://ethresear.ch/t/mev-auction-auctioning-transaction-ordering-rights-as-a-solution-to-miner-extractable-value/6788)”提议)。Vitalik Buterin 最近提出，以太坊可以主要成为 rollups 的数据可用性层，而 rollups 负责处理所有交易执行，[将 MEV 捕获集中到 rollup 的序列器中](https://medium.com/@VitalikButerin/i-feel-like-this-post-is-addressing-an-argument-that-isnt-the-actual-argument-that-mev-auction-b3c5e8fc1021) (“ETH 1.5”)。\n\n这将与以太坊当前设计大相径庭，并且需要权衡取舍。例如，rollup 之间以及 rollup 与主链之间互操作性会破坏同步性，可能需要在实践中进行不同的假设 (尤其是在一个多 rollup 的环境中)。Paradigm 的投资组合公司正研发两种类型的 rollup 解决方案：\n\n\n\n### StarkWare\n\n[StarkWare](https://starkware.co/) 正研发 [ZK-Rollup](https://medium.com/starkware/on-the-road-to-starknet-a-permissionless-stark-powered-l2-zk-rollup-83be53640880) (ZKRU)，即主动打包有效的可验证的证明进区块，而不是乐观地假设证明有效但可以提供欺诈证明。\n\n虽然这最初不是为了分离交易执行和排序所提出的方案，但 ZKRU 可以实现这一点。这个证明引擎还可以用于对排序施加额外的约束 (如果基于 VDF 的优先级排序和其他确定性排序机制可用)。\n\n### Optimism\n\n[Optimism](https://optimism.io/) 所研发的是 Optimistic Rollup (ORU)，即乐观假设证明的有效性但允许被挑战，并向以太坊广播检查欺诈证明所需的最小限度的数据。这将导致相对较长的敲定窗口期，但是这个方案允许使用与以太坊 Layer1 EVM 相同的执行环境 (这意味着现有的合约可以实现无缝迁移)。\n\nOptimism 是 MEVA 和 ETH 1.5 的最初提出者。\n\n## Flashbots\n\n[Flashbots](https://github.com/flashbots/pm) 是一个研发阻止，旨在缓解以太坊上由 MEV 带来的负面外部效应和存在的风险。他们已经建立了工具以量化 MEV 并且减少生态中的信息不对称性。他们正在实现一种无需许可 MEV 提取的概念证明，称为 MEV-Geth。这是种密封投标 (sealed-bid) 的区块空间竞拍机制，用于实现交易顺序偏好通讯。\n\nFlashbots 的目标是确保 MEV 的激励不会失去透明性和民主性。希望他们的基础架构将允许应用开发者更好地了解如何更大程度地解决 MEV 问题，并释放一些压力，否则累积后会带来更加具有危害性的外部效应 (如时间盗贼攻击)。\n\n## Cosmos\n\n[Cosmos](https://cosmos.network/intro) 是无需许可、可进行互操作应用的另一种替代模型。虽然没有与以太坊上的 MEV 直接相关，但是 Cosmos可以在不采用以太坊的“统一安全”范式的情况下，在其应用生态上实现类似以太坊的复杂性。\n\n可以想象 Cosmos 区块链将基本上实现“应用相对独立性”，并在默认情况下不会与其他应用共享安全性。这一设置允许其避免在共享平台上出现的有害外部效应。如果以太坊朝着 ETH1.5的方向发展，看起来将类似于 Cosmos (事实上 [LazyLedger](https://twitter.com/lazyledger_org?lang=en) 就是 Cosmos 版的 ETH1.5)\n\n<br/>\n\n# 致谢\n\n\n非常感谢我的同事Arjun Balaji、Dan Robinson、Georgios Konstantopoulos、以及Matt Huang，还有Hasu跟我一起讨论，并给我这篇文章提供反馈与信息。\n\n<br/>\n\n# 免责声明\n\n本文仅供参考，并不构成购买与出售任何投资的投资建议或推荐或招揽，也不应被用于评估任何投资决定依据。本文不应作为会计、法律或税务建议或投资建议的依据。本文反映了作者当前的观点，并不代表Paradigm、其关联公司、或与Paradigm相关的人员。本文表达的观点可能会发生变化而随之更新。\n\n<br/>\n\n# 注解\n\n1. 文章《[论比特币没有区块奖励所带来的不稳定性](https://dl.acm.org/doi/10.1145/2976749.2978408)》可以说是首次对 MEV 进行了清晰的定性，表明“正常的”比特币交易费是矿工收益的非常规来源，并且助长共识不稳定性 (激励对费用高的区块进行重组，而不是挖费用少的区块)。\n\n2. 我的意思是，独立于 BTC 通胀率的，比特币 MEV 不太可能随着时间增长。对于通胀率下降的担忧，应截然不同于我们担心 MEV 是否会恶化。[↩](https://research.paradigm.xyz/MEV#fnref:2)\n\n3. EIP-1559把交易费拆分为两个部分：基本费用和小费竞卖。基本费用决定了所有交易里都要销毁的ETH数。小费竞卖基本上只是一个PGA。尽管基本费用销毁会提高协议安全性 (因为它们不是一个非常规矿工收益流)，任何有MEV的交易仍然需要在小费拍卖中竞争。当然，交易费肯定需要竞卖部分以在协议内反映需求。如果没有这个部分，矿工和交易者可能会在协议外的市场里合谋。因此，只有销毁了基本费用才有助于协议安全。\n\nECN的翻译工作旨在为中国以太坊社区传递优质资讯和学习资源，文章版权归原作者所有，转载须注明原文出处以及ethereum.cn，若需长期转载，请联系eth@ecn.co进行授权。\n","cover":{"childImageSharp":{"resize":{"src":"/static/75362982fca00faf5734563a731669b7/497c6/c2216f4a7772c6e799fc62153c2e1f50.png"}}}},"site":{"siteMetadata":{"title":"Ethereum Community Network","description":"以太坊——全球的、开源的去中心化应用平台。DeFi？NFT？游戏？虚拟世界？每一个人都可以成为以太坊的开发者和用户！","author":"@ECN以太坊社区网络","keywords":"以太坊,以太坊中国,Ethereum","siteLanguage":"zh-CN","siteLocale":"zh-cn","siteUrl":"http://ethereum.cn","twitterUsername":"@EthereumCN"}}},"pageContext":{"id":"Articles_213"}},"staticQueryHashes":["1238767529","2940180826"]}